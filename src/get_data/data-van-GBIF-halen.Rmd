---
title: "Natuurindicatoren"
author: "Yasmine Verzelen"
date: "24 oktober 2017"
output: html_document
---

In dit script willen we de data van waarnemingen.be van GBIF halen, voor niet-inheemse planten en dieren.

Load packages
```{r}
library(rgbif)
library(curl)
library(ggplot2)
#library(INBOtheme)
```

Number of records in Waarnemingen.be datasets
```{r}
'Plants'
occ_count(datasetKey='7f5e4129-0717-428e-876a-464fbd5d9a47')
'Animals'
occ_count(datasetKey='9a0b66df-7535-4f28-9f4e-5bc11b8b096c')

```
Get the data from the datasets
```{r}
'Animals'
WnmBe_Animals <- occ_download_get(key = "0006839-171025204727650", overwrite = TRUE) %>% 
    occ_download_import(WnmBe_Animals_download, na.strings = c("", NA))
WnmBe_Animals$species <- as.character(WnmBe_Animals$species)

'Plants'
WnmBe_Plants <- occ_download_get(key = "0006843-171025204727650", overwrite = TRUE) %>% 
    occ_download_import(WnmBe_Plants_download, na.strings = c("", NA))

```

Merge the datasets
```{r}
WnmBe_All <- rbind(WnmBe_Animals, WnmBe_Plants)
```
Calculate the first occurence per species
```{r}
WnmBe_All <- subset(WnmBe_All, !is.na(species))
species <- unique(WnmBe_All$species)
species_list <- data.frame()
for(s in species){
  temp <- subset(WnmBe_All, species == s)
  temp2 <- data.frame(s)
  temp2$firstyear <- min(temp$year)
  temp2$kingdom <- unique(temp$kingdom)
  temp2$phylum <- unique(temp$phylum)
  temp2$class <- unique(temp$class)
  species_list <- rbind(species_list, temp2)
}

remove(temp)
remove(temp2)

```

Caculate the cumulative number of invasive species and display in a graph

```{r}

firstrecord <- min(species_list$firstyear)
newestrecord <- max(unique(WnmBe_All$year))
tijdspanne <- (newestrecord-firstrecord)+1

new_species <- data.frame()
temp2 <- data.frame(1)
t <- firstrecord

for(i in 1:tijdspanne){
  temp <- subset(species_list, firstyear == t)
  temp2$n <- nrow(temp)
  temp2$t <- t
  new_species <- rbind(new_species, temp2)
  t <- t + 1
}

new_species$X1 <- NULL
new_species$cumul <- cumsum(new_species$n)

plot <- ggplot(new_species, aes(x = t, y=cumul))+
  geom_line() +
  scale_x_continuous(breaks = seq(1800, 2017, 10))
print(plot)

```

Calculate the cumulative number of invasive species per kingdom and total and display in a graph
```{r}

firstrecord <- min(species_list$firstyear)
newestrecord <- max(unique(WnmBe_All$year))
tijdspanne <- (newestrecord-firstrecord)+1

new_species_k <- data.frame()
temp2 <- data.frame(1)
temp3 <- data.frame(1)
t <- firstrecord

kingdoms <- unique(species_list$kingdom)
for(k in kingdoms){
  temp <- subset(species_list, kingdom == k)
  for(i in 1:tijdspanne){
    temp2 <- subset(temp, firstyear == t)
    temp3$n <- nrow(temp2)
    temp3$t <- t
    temp3$kingdom <- k
    new_species_k <- rbind(new_species_k, temp3)
    t <- t + 1
  }
  t <- firstrecord
}

new_species_k$X1 <- NULL
new_species_k2 <-  transform(new_species_k,cumul = ave(n , kingdom, FUN = cumsum))

plot <- ggplot(new_species_k2, aes(x = t, y=cumul,colour=kingdom))+
  scale_x_continuous(breaks = seq(1800, 2017, 10))+
  geom_line()

print(plot)

```

