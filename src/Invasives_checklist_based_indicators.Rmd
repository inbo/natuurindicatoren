---
title: "Invasives_checklist_based_indicators"
author: "Sander Devisscher, Tim Adriaens"
date: "29 juli 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(trias)
library(rgbif)
library(tidyverse)
library(INBOtheme)
```

```{r}
#Voorlopige bron tot de regios opgenomen zijn in de unified checklist
#------
distributions_unified <- read_csv("https://raw.githubusercontent.com/trias-project/unified-checklist/include-distribution-regions/data/interim/distributions_unified.csv")
#------

#Flow om de data van gbif af te halen (nog niet bruikbaar)
#------
#taxa <- name_usage(datasetKey = "6d9e952f-948c-4483-9807-575348147c7e",
 #                  return = "data",
  #                 limit = 10000) %>%
  #filter(origin == "SOURCE")

#checklist_info <- c("key", "nubKey", "scientificName", "datasetKey",
       #             "canonicalName", "species", "genus", "family", 
        #            "order", "class", "phylum", "kingdom",	
         #           "rank", "speciesKey", "taxonomicStatus", 	
          #          "acceptedKey", "accepted")
#taxa <-
 # taxa %>%
  #select(one_of(checklist_info))

#distributions_unified <- taxa %>%
 # pull(key) %>%
  #map_dfr(~ name_usage(.,
   #                  return = "data",
    #                 data = "distribution")) %>% 
  #select(-source)
#head(distribution)
#------
```

```{r}
table(distributions_unified$locality,useNA = "ifany")

checklist_flanders <- distributions_unified %>% 
  filter(locality == "Flemish Region")

#Te disablen wanneer de data van gbif komt
#---------------------------------------------
taxonkeys <- checklist_flanders$taxonKeys[!is.na(checklist_flanders$taxonKeys)]

sum(is.na(taxonkeys))

taxa <- gbif_get_taxa(taxon_keys = taxonkeys) 
#----------------------------------------------

checklist_flanders2 <- checklist_flanders %>% 
  left_join(taxa, by = c("taxonKeys" = "key")) %>% 
  filter(kingdom %in% c("Animalia", "Plantae"))

p <- indicator_total_year(checklist_flanders2, start_year_plot = 1940,
  x_major_scale_stepsize = 10, x_minor_scale_stepsize = 5,
  facet_column = "kingdom", first_observed = "startYear")

ggsave("data/processed/Invasives_cummulative_first_observed_kingdom.jpg", plot = p )
```
 
